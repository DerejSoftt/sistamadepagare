<!DOCTYPE html>
{% load static %}
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora de Préstamos | Sistema de Préstamos</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    :root {
        --primary: #2563eb;
        --primary-light: #3b82f6;
        --primary-dark: #1d4ed8;
        --secondary: #7c3aed;
        --accent: #10b981;
        --danger: #ef4444;
        --warning: #f59e0b;
        --dark: #1e293b;
        --light: #f8fafc;
        --gray: #64748b;
        --light-gray: #e2e8f0;
        --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    body {
        background-color: #f1f5f9;
        color: var(--dark);
        line-height: 1.6;
        display: flex;
        min-height: 100vh;
        overflow-x: hidden;
    }

    /* Sidebar */
    .sidebar {
        width: 280px;
        min-width: 280px;
        background: white;
        color: var(--dark);
        padding: 1.5rem 1rem;
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        box-shadow: var(--card-shadow);
        z-index: 100;
        transition: var(--transition);
        overflow-y: auto;
        border-right: 1px solid var(--light-gray);
    }

    .sidebar-header {
        display: flex;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid var(--light-gray);
    }

    .sidebar-header img {
        width: 40px;
        margin-right: 12px;
    }

    .sidebar-header h2 {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--primary);
    }

    .nav-menu {
        list-style: none;
    }

    .nav-item {
        margin-bottom: 0.5rem;
    }

    .nav-link {
        display: flex;
        align-items: center;
        padding: 0.75rem 1rem;
        color: var(--gray);
        text-decoration: none;
        border-radius: 8px;
        transition: var(--transition);
        font-weight: 500;
    }

    .nav-link i {
        margin-right: 12px;
        width: 20px;
        text-align: center;
        font-size: 1rem;
    }

    .nav-link:hover, .nav-link.active {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--primary);
    }

    .nav-link.active {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--primary);
        font-weight: 600;
    }

    /* Contenido principal */
    .main-content {
        flex: 1;
        margin-left: 280px;
        padding: 1.5rem;
        transition: var(--transition);
        min-width: 0;
        width: calc(100% - 280px);
    }

    /* Header */
    .page-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    .page-header h1 {
        font-size: clamp(1.8rem, 4vw, 2.2rem);
        color: var(--primary);
        margin-bottom: 0.5rem;
        font-weight: 700;
    }

    .page-header p {
        color: var(--gray);
        font-size: clamp(0.9rem, 2vw, 1.05rem);
        max-width: 700px;
        margin: 0 auto;
    }

    /* Contenedor de la calculadora */
    .calculator-container {
        background: white;
        border-radius: 12px;
        padding: clamp(1.5rem, 3vw, 2.5rem);
        box-shadow: var(--card-shadow);
        border: 1px solid var(--light-gray);
        max-width: 1200px;
        margin: 0 auto;
        overflow: hidden;
    }

    /* Alert Messages */
    .alert-messages {
        margin-bottom: 1.5rem;
    }

    .alert {
        padding: 0.75rem 1rem;
        border-radius: 8px;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
    }

    .alert-success {
        background-color: rgba(16, 185, 129, 0.1);
        color: var(--accent);
        border: 1px solid var(--accent);
    }

    .alert-error {
        background-color: rgba(239, 68, 68, 0.1);
        color: var(--danger);
        border: 1px solid var(--danger);
    }

    .alert i {
        margin-right: 0.5rem;
    }

    .container-header {
        display: flex;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid var(--light-gray);
    }

    .container-header i {
        font-size: 1.8rem;
        color: var(--primary);
        margin-right: 1rem;
    }

    .container-header h2 {
        font-size: clamp(1.2rem, 3vw, 1.5rem);
        color: var(--dark);
    }

    /* Sección de búsqueda */
    .search-section {
        background: #f8fafc;
        border: 1px solid var(--light-gray);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }

    .search-header {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
    }

    .search-header i {
        font-size: 1.2rem;
        color: var(--primary);
        margin-right: 0.75rem;
    }

    .search-header h3 {
        font-size: 1.1rem;
        color: var(--dark);
        margin: 0;
    }

    .search-container {
        position: relative;
    }

    .search-input-group {
        display: flex;
        gap: 0.75rem;
        align-items: center;
        flex-wrap: wrap;
    }

    .search-input {
        flex: 1;
        min-width: 300px;
        padding: 0.75rem 1rem;
        border: 1px solid var(--light-gray);
        border-radius: 8px;
        font-size: 0.95rem;
        transition: var(--transition);
        background-color: white;
    }

    .search-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .search-btn {
        white-space: nowrap;
    }

    .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid var(--light-gray);
        border-radius: 8px;
        box-shadow: var(--card-shadow);
        z-index: 10;
        margin-top: 0.5rem;
        max-height: 300px;
        overflow-y: auto;
    }

    .results-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 1rem;
        background: #f8fafc;
        border-bottom: 1px solid var(--light-gray);
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--gray);
    }

    .close-results {
        background: none;
        border: none;
        color: var(--gray);
        cursor: pointer;
        padding: 0.25rem;
        border-radius: 4px;
        transition: var(--transition);
    }

    .close-results:hover {
        background: var(--light-gray);
        color: var(--dark);
    }

    .results-list {
        max-height: 240px;
        overflow-y: auto;
    }

    .result-item {
        padding: 1rem;
        border-bottom: 1px solid var(--light-gray);
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .result-item:hover {
        background: #f8fafc;
    }

    .result-item:last-child {
        border-bottom: none;
    }

    .client-info {
        flex: 1;
    }

    .client-name {
        font-weight: 600;
        color: var(--dark);
        margin-bottom: 0.25rem;
    }

    .client-cedula {
        font-size: 0.9rem;
        color: var(--gray);
    }

    .select-btn {
        background: var(--primary);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: var(--transition);
    }

    .select-btn:hover {
        background: var(--primary-dark);
    }

    .no-results {
        padding: 2rem;
        text-align: center;
        color: var(--gray);
    }

    .no-results i {
        font-size: 2rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }

    .form-divider {
        text-align: center;
        margin: 2rem 0;
        position: relative;
    }

    .form-divider::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 1px;
        background: var(--light-gray);
    }

    .form-divider span {
        background: white;
        padding: 0 1rem;
        color: var(--gray);
        font-size: 0.9rem;
        position: relative;
        z-index: 1;
    }

    /* Formulario */
    .form-row {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
    }

    .form-col {
        flex: 1;
        min-width: 250px;
    }

    .form-col-full {
        flex: 1 1 100%;
    }

    label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: var(--dark);
        font-size: 0.9rem;
    }

    input, select, textarea {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid var(--light-gray);
        border-radius: 8px;
        font-size: 0.95rem;
        transition: var(--transition);
        background-color: white;
    }

    input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .btn {
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        border: none;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.95rem;
        white-space: nowrap;
    }

    .btn-primary {
        background-color: var(--primary);
        color: white;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    }

    .btn-primary:hover {
        background-color: var(--primary-dark);
        transform: translateY(-1px);
    }

    .btn-success {
        background-color: var(--accent);
        color: white;
    }

    .btn-success:hover {
        background-color: #0ca678;
        transform: translateY(-1px);
    }

    .btn-group {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
        flex-wrap: wrap;
    }

    /* Resultados */
    .results-section {
        margin-top: 2rem;
        display: none;
    }

    .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .result-card {
        background: linear-gradient(135deg, var(--primary), var(--primary-light));
        color: white;
        padding: 1.5rem;
        border-radius: 12px;
        text-align: center;
        box-shadow: var(--card-shadow);
    }

    .result-card h3 {
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
        opacity: 0.9;
    }

    .result-card p {
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0;
    }

    /* Tabla de amortización */
    .table-container {
        overflow-x: auto;
        margin-top: 2rem;
        border-radius: 8px;
        border: 1px solid var(--light-gray);
        display: none;
    }

    .amortization-table {
        width: 100%;
        min-width: 600px;
        border-collapse: collapse;
        font-size: 0.9rem;
    }

    .amortization-table th {
        background-color: var(--primary);
        color: white;
        font-weight: 600;
        text-align: center;
        padding: 1rem 0.75rem;
        border-bottom: 1px solid var(--light-gray);
        white-space: nowrap;
    }

    .amortization-table td {
        padding: 0.75rem;
        border-bottom: 1px solid var(--light-gray);
        text-align: center;
        vertical-align: middle;
    }

    .amortization-table tr:hover {
        background-color: #f8fafc;
    }

    /* Menú móvil */
    .mobile-menu-btn {
        display: none;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 50%;
        width: 44px;
        height: 44px;
        font-size: 1.25rem;
        cursor: pointer;
        position: fixed;
        top: 1.5rem;
        left: 1.5rem;
        z-index: 101;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        transition: var(--transition);
    }

    .mobile-menu-btn:hover {
        transform: scale(1.05);
    }

    .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99;
        backdrop-filter: blur(2px);
    }

    /* Responsive */
    @media (max-width: 992px) {
        .sidebar {
            transform: translateX(-100%);
            width: 280px;
            min-width: 280px;
        }
        .sidebar.active {
            transform: translateX(0);
        }
        .main-content {
            margin-left: 0;
            width: 100%;
            padding: 1rem;
        }
        .mobile-menu-btn {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .page-header {
            margin-top: 3rem;
        }
        .form-col {
            min-width: 100%;
        }
    }

    @media (max-width: 768px) {
        .calculator-container {
            padding: 1rem;
        }
        .page-header h1 {
            font-size: 1.6rem;
        }
        .btn-group {
            flex-direction: column;
        }
        .btn {
            width: 100%;
            justify-content: center;
        }
        .results-grid {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 576px) {
        .main-content {
            padding: 0.75rem;
        }
        .calculator-container {
            padding: 0.75rem;
        }
        .page-header {
            margin-bottom: 1.5rem;
        }
        .container-header {
            margin-bottom: 1.5rem;
        }
        .amortization-table {
            min-width: 500px;
        }
        .amortization-table th,
        .amortization-table td {
            padding: 0.5rem 0.25rem;
        }
    }

    /* Animaciones */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .animate-fade {
        animation: fadeIn 0.5s ease forwards;
    }

    /* Mejoras para scroll horizontal en tabla */
    .table-container::-webkit-scrollbar {
        height: 8px;
    }

    .table-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }

    .table-container::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 4px;
    }

    .table-container::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
    }

    /* Responsive para búsqueda */
    @media (max-width: 768px) {
        .search-input-group {
            flex-direction: column;
        }

        .search-input {
            min-width: 100%;
        }

        .search-btn {
            width: 100%;
            justify-content: center;
        }

        .result-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .select-btn {
            width: 100%;
        }
    }
</style>
</head>
<body>
<!-- Botón de menú móvil -->
<button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu">
    <i class="fas fa-bars"></i>
</button>

<!-- Overlay para menú móvil -->
<div class="overlay" id="overlay"></div>

<!-- Sidebar -->
<aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <h2>Sistema Préstamos</h2>
    </div>
    <nav aria-label="Main navigation">
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="#" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'formulario' %}" class="nav-link">
                    <i class="fas fa-user-plus"></i>
                    <span>Registrar Cliente</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'clientes' %}" class="nav-link">
                    <i class="fas fa-users"></i>
                    <span>Perfil del Cliente</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'calc' %}" class="nav-link active" aria-current="page">
                    <i class="fas fa-calculator"></i>
                    <span>Calculadora de Préstamos</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'prestamospagados' %}" class="nav-link">
                    <i class="fas fa-check-circle"></i>
                    <span>Préstamos Pagados</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'anulacion' %}" class="nav-link">
                    <i class="fas fa-times-circle"></i>
                    <span>Facturas Anuladas</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'despacho' %}" class="nav-link">
                    <i class="fas fa-history"></i>
                    <span>Despacho</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'reporte' %}" class="nav-link">
                    <i class="fas fa-chart-bar"></i>
                    <span>Análisis</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'index' %}" class="nav-link">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Cerrar Sesión</span>
                </a>
            </li>
        </ul>
    </nav>
</aside>

<!-- Contenido principal -->
<main class="main-content" id="mainContent">
    <!-- Header de página -->
    <header class="page-header animate-fade">
        <h1>Calculadora de Préstamos</h1>
        <p>Calcula préstamos con interés simple y genera tabla de amortización</p>
    </header>

    <div class="calculator-container animate-fade">
        <!-- Mensajes de Django -->
        {% if messages %}
        <div class="alert-messages">
            {% for message in messages %}
            <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
                <i class="fas {% if message.tags == 'success' %}fa-check-circle{% else %}fa-exclamation-circle{% endif %}"></i>
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="container-header">
            <i class="fas fa-calculator"></i>
            <h2>Calculadora de Préstamos RD</h2>
        </div>

        <!-- Barra de búsqueda de clientes -->
        <div class="search-section">
            <div class="search-header">
                <i class="fas fa-search"></i>
                <h3>Buscar Cliente Existente</h3>
            </div>
            <div class="search-container">
                <div class="search-input-group">
                    <input type="text" id="searchInput" class="search-input" placeholder="Buscar por cédula o nombre del cliente...">
                    <button type="button" class="btn btn-primary search-btn" onclick="buscador_cliente()">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                </div>
                <div class="search-results" id="searchResults" style="display: none;">
                    <div class="results-header">
                        <span>Resultados de búsqueda:</span>
                        <button type="button" class="close-results" onclick="cerrarResultados()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="results-list" id="resultsList">
                        <!-- Los resultados se cargarán aquí -->
                    </div>
                </div>
            </div>
        </div>

        <div class="form-divider">
            <span>O registrar nuevo cliente</span>
        </div>

        <!-- Formulario de la calculadora -->
        <form method="POST" action="{% url 'calc' %}" id="formularioPrestamo">
            {% csrf_token %}
            
            <!-- Datos del cliente -->
            <div class="form-row">
                <div class="form-col">
                    <label for="cedula">Cédula</label>
                    <input type="text" id="cedula" name="cedula" required placeholder="320-1236549-5" 
                           value="{{ form_data.cedula|default_if_none:'' }}">
                </div>
                <div class="form-col">
                    <label for="nombre">Nombre completo</label>
                    <input type="text" id="nombre" name="nombre" required placeholder="Nombre del cliente"
                           value="{{ form_data.nombre|default_if_none:'' }}">
                </div>
            </div>

            <!-- Tipo de préstamo y monto -->
            <div class="form-row">
                <div class="form-col">
                    <label for="tipoPrestamo">Tipo de préstamo</label>
                    <select id="tipoPrestamo" name="tipoPrestamo" required>
                        <option value="">Seleccionar tipo</option>
                        <option value="personal" {% if form_data.tipoPrestamo == 'personal' %}selected{% endif %}>Préstamo Personal</option>
                        <option value="vehiculo" {% if form_data.tipoPrestamo == 'vehiculo' %}selected{% endif %}>Préstamo para Vehículo</option>
                        <option value="vivienda" {% if form_data.tipoPrestamo == 'vivienda' %}selected{% endif %}>Préstamo para Vivienda</option>
                        <option value="negocio" {% if form_data.tipoPrestamo == 'negocio' %}selected{% endif %}>Préstamo para Negocio</option>
                        <option value="emergencia" {% if form_data.tipoPrestamo == 'emergencia' %}selected{% endif %}>Préstamo de Emergencia</option>
                        <option value="educacion" {% if form_data.tipoPrestamo == 'educacion' %}selected{% endif %}>Préstamo Educativo</option>
                    </select>
                </div>
                <div class="form-col">
                    <label for="monto">Monto del préstamo (RD$)</label>
                    <input type="text" id="monto" name="monto" required placeholder="1,000,000.00" 
                           pattern="^\d{1,3}(,\d{3})*(\.\d+)?$" value="{{ form_data.monto|default_if_none:'' }}">
                </div>
            </div>

            <!-- Tasa y plazo -->
            <div class="form-row">
                <div class="form-col">
                    <label for="tasa">Tasa de interés mensual (%)</label>
                    <input type="number" id="tasa" name="tasa" step="0.01" required placeholder="5.00"
                           value="{{ form_data.tasa|default_if_none:'' }}">
                </div>
                <div class="form-col">
                    <label for="plazo">Plazo (meses)</label>
                    <input type="number" id="plazo" name="plazo" min="1" max="12" required placeholder="6"
                           value="{{ form_data.plazo|default_if_none:'' }}">
                </div>
            </div>

            <!-- Frecuencia y mora -->
            <div class="form-row">
                <div class="form-col">
                    <label for="frecuencia">Frecuencia de pagos</label>
                    <select id="frecuencia" name="frecuencia" required>
                        <option value="">Seleccionar frecuencia</option>
                        <option value="1" {% if form_data.frecuencia == '1' %}selected{% endif %}>Mensual</option>
                        <option value="2" {% if form_data.frecuencia == '2' %}selected{% endif %}>Quincenal</option>
                        <option value="4" {% if form_data.frecuencia == '4' %}selected{% endif %}>Semanal</option>
                    </select>
                </div>
                <div class="form-col">
                    <label for="tasaMora">Tasa de mora por retraso (%)</label>
                    <input type="number" id="tasaMora" name="tasaMora" step="0.01" min="0" placeholder="2.00" 
                           value="{{ form_data.tasaMora|default_if_none:'2.00' }}">
                    <small style="color: var(--gray); font-size: 0.8rem; margin-top: 0.25rem; display: block;">
                        Porcentaje adicional aplicado por cada día de retraso
                    </small>
                </div>
            </div>

            <!-- Campo de observación -->
            <div class="form-row">
                <div class="form-col-full">
                    <label for="observacion">Observación</label>
                    <textarea id="observacion" name="observacion" rows="3" placeholder="Notas adicionales sobre este préstamo...">{{ form_data.observacion|default_if_none:'' }}</textarea>
                </div>
            </div>

            <!-- Botones de acción -->
            <div class="btn-group">
                <button type="button" class="btn btn-primary" onclick="calcularPrestamo()">
                    <i class="fas fa-calculator"></i> Calcular
                </button>
                <button type="button" class="btn btn-success" onclick="guardarInformacion()">
                    <i class="fas fa-save"></i> Guardar
                </button>
            </div>
        </form>

        <!-- Resultados -->
        <div id="resultado" class="results-section" {% if prestamo %}style="display: block;"{% endif %}>
            <div class="results-grid">
                <div class="result-card">
                    <h3>Monto del préstamo</h3>
                    <p id="montoResumen">{% if prestamo %}{{ prestamo.monto|floatformat:2 }}{% else %}RD$0.00{% endif %}</p>
                </div>
                <div class="result-card">
                    <h3>Total a pagar</h3>
                    <p id="total">{% if prestamo %}{{ prestamo.total_pagar|floatformat:2 }}{% else %}RD$0.00{% endif %}</p>
                </div>
                <div class="result-card">
                    <h3>Intereses totales</h3>
                    <p id="intereses">{% if prestamo %}{{ prestamo.total_intereses|floatformat:2 }}{% else %}RD$0.00{% endif %}</p>
                </div>
                <div class="result-card">
                    <h3>Pago por período</h3>
                    <p id="pagoPeriodo">{% if prestamo %}{{ prestamo.pago_periodico|floatformat:2 }}{% else %}RD$0.00{% endif %}</p>
                </div>
            </div>
        </div>

        <!-- Tabla de amortización -->
        <div class="table-container" id="tablaContainer" {% if prestamo %}style="display: block;"{% endif %}>
            <table class="amortization-table" id="tablaAmortizacion">
                <thead>
                    <tr>
                        <th>Pago #</th>
                        <th>Capital</th>
                        <th>Interés</th>
                        <th>Total Pago</th>
                        <th>Balance</th>
                    </tr>
                </thead>
                <tbody id="cuerpoTabla">
                    {% if tabla_amortizacion %}
                        {% for pago in tabla_amortizacion %}
                        <tr>
                            <td>{{ pago.numero }}</td>
                            <td>{{ pago.capital|floatformat:2 }}</td>
                            <td>{{ pago.interes|floatformat:2 }}</td>
                            <td>{{ pago.total_pago|floatformat:2 }}</td>
                            <td>{{ pago.balance|floatformat:2 }}</td>
                        </tr>
                        {% endfor %}
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
// document.addEventListener('DOMContentLoaded', function() {
//     // Control del menú móvil
//     const mobileMenuBtn = document.getElementById('mobileMenuBtn');
//     const sidebar = document.getElementById('sidebar');
//     const overlay = document.getElementById('overlay');

//     function toggleMenu() {
//         sidebar.classList.toggle('active');
//         overlay.style.display = sidebar.classList.contains('active') ? 'block' : 'none';
//         document.body.style.overflow = sidebar.classList.contains('active') ? 'hidden' : 'auto';
//     }

//     mobileMenuBtn.addEventListener('click', toggleMenu);
//     overlay.addEventListener('click', toggleMenu);

//     // Manejar cambios de tamaño de pantalla
//     window.addEventListener('resize', function() {
//         if (window.innerWidth > 992) {
//             sidebar.classList.remove('active');
//             overlay.style.display = 'none';
//             document.body.style.overflow = 'auto';
//         }
//     });

//     // Mostrar resultados si hay un préstamo cargado
//     {% if prestamo %}
//         document.getElementById('resultado').style.display = 'block';
//         document.getElementById('tablaContainer').style.display = 'block';
//     {% endif %}

//     // Configurar eventos de búsqueda
//     const searchInput = document.getElementById('searchInput');
//     searchInput.addEventListener('input', debounce(buscador_cliente, 300));
//     searchInput.addEventListener('keypress', function(e) {
//         if (e.key === 'Enter') {
//             buscador_cliente();
//         }
//     });

//     // Configurar validación de cédula en tiempo real
//     document.getElementById('cedula').addEventListener('input', function(e) {
//         // Eliminar guiones automáticamente
//         this.value = this.value.replace(/-/g, '');
        
//         // Validación visual
//         if (this.value.length !== 11 || !/^\d+$/.test(this.value)) {
//             this.style.borderColor = 'var(--danger)';
//         } else {
//             this.style.borderColor = '';
//         }
//     });

//     // Configurar formato de monto
//     document.getElementById('monto').addEventListener('input', formatCurrencyInput);
// });

// // Función para formatear entrada de moneda
// function formatCurrencyInput(e) {
//     let value = e.target.value.replace(/,/g, '');
//     if(!isNaN(value) && value !== '') {
//         e.target.value = parseFloat(value).toLocaleString('es-DO');
//     }
// }

// // Función de formato RD
// function formatoRD(numero) {
//     return new Intl.NumberFormat('es-DO', {
//         style: 'currency',
//         currency: 'DOP',
//         minimumFractionDigits: 2,
//         maximumFractionDigits: 2
//     }).format(numero);
// }

// // Función de formato RD para enteros
// function formatoRDEnteros(numero) {
//     return new Intl.NumberFormat('es-DO', {
//         style: 'currency',
//         currency: 'DOP',
//         minimumFractionDigits: 0,
//         maximumFractionDigits: 0
//     }).format(Math.round(numero));
// }

// // Función para cerrar resultados de búsqueda
// function cerrarResultados() {
//     document.getElementById('searchResults').style.display = 'none';
// }

// // Función debounce para evitar múltiples llamadas
// function debounce(func, wait) {
//     let timeout;
//     return function() {
//         const context = this, args = arguments;
//         clearTimeout(timeout);
//         timeout = setTimeout(() => func.apply(context, args), wait);
//     };
// }

// // Función para buscar clientes en el servidor
// async function buscador_cliente() {
//     const searchTerm = document.getElementById('searchInput').value.trim();
//     const searchResults = document.getElementById('searchResults');
//     const resultsList = document.getElementById('resultsList');
    
//     if (searchTerm.length < 2) {
//         searchResults.style.display = 'none';
//         return;
//     }
    
//     try {
//         // Mostrar indicador de carga
//         resultsList.innerHTML = '<div class="no-results"><i class="fas fa-spinner fa-spin"></i><p>Buscando clientes...</p></div>';
//         searchResults.style.display = 'block';
        
//         const response = await fetch(`/buscador-cliente/?q=${encodeURIComponent(searchTerm)}`);
        
//         if (!response.ok) {
//             throw new Error(`Error HTTP: ${response.status}`);
//         }
        
//         const clientes = await response.json();
        
//         resultsList.innerHTML = '';
        
//         if (clientes.length > 0) {
//             clientes.forEach(cliente => {
//                 const resultItem = document.createElement('div');
//                 resultItem.className = 'result-item';
//                 resultItem.innerHTML = `
//                     <div class="client-info">
//                         <div class="client-name">${cliente.nombres}</div>
//                         <div class="client-cedula">Cédula: ${cliente.numero_identificacion}</div>
//                         ${cliente.telefono ? `<div class="client-phone">Tel: ${cliente.telefono}</div>` : ''}
//                     </div>
//                     <button class="select-btn" onclick="seleccionarCliente('${cliente.numero_identificacion}', '${cliente.nombres.replace(/'/g, "\\'")}')">
//                         <i class="fas fa-check"></i> Seleccionar
//                     </button>
//                 `;
//                 resultsList.appendChild(resultItem);
//             });
//         } else {
//             resultsList.innerHTML = `
//                 <div class="no-results">
//                     <i class="fas fa-user-slash"></i>
//                     <p>No se encontraron clientes con ese criterio de búsqueda</p>
//                 </div>
//             `;
//         }
//     } catch (error) {
//         console.error('Error al buscar clientes:', error);
//         resultsList.innerHTML = `
//             <div class="no-results">
//                 <i class="fas fa-exclamation-triangle"></i>
//                 <p>Error al buscar clientes. Intente nuevamente.</p>
//             </div>
//         `;
//     }
// }

// // Función para seleccionar un cliente
// function seleccionarCliente(cedula, nombre) {
//     // Eliminar guiones si existen
//     const cedulaLimpia = cedula.replace(/-/g, '');
//     document.getElementById('cedula').value = cedulaLimpia;
//     document.getElementById('nombre').value = nombre;
//     cerrarResultados();
//     mostrarNotificacion(`Cliente seleccionado: ${nombre}`);
//     document.getElementById('tipoPrestamo').focus();
// }

// // Función para mostrar notificaciones
// function mostrarNotificacion(mensaje, tipo = 'success') {
//     const notificacion = document.createElement('div');
//     notificacion.className = `notificacion notificacion-${tipo}`;
//     notificacion.innerHTML = `
//         <i class="fas ${tipo === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
//         <span>${mensaje}</span>
//     `;
    
//     document.body.appendChild(notificacion);
    
//     // Animación de entrada
//     setTimeout(() => {
//         notificacion.style.opacity = '1';
//         notificacion.style.transform = 'translateY(0)';
//     }, 10);
    
//     // Remover después de 3 segundos
//     setTimeout(() => {
//         notificacion.style.opacity = '0';
//         notificacion.style.transform = 'translateY(-20px)';
//         setTimeout(() => notificacion.remove(), 300);
//     }, 3000);
// }

// // Función para calcular el préstamo
// function calcularPrestamo() {
//     // Obtener y validar valores
//     const cedula = document.getElementById('cedula').value.trim();
//     const nombre = document.getElementById('nombre').value.trim();
//     const tipoPrestamo = document.getElementById('tipoPrestamo').value;
//     const monto = parseFloat(document.getElementById('monto').value.replace(/,/g, '')) || 0;
//     const tasaMensual = parseFloat(document.getElementById('tasa').value) / 100 || 0;
//     const plazo = parseInt(document.getElementById('plazo').value) || 0;
//     const frecuencia = parseInt(document.getElementById('frecuencia').value) || 0;
//     const tasaMora = parseFloat(document.getElementById('tasaMora').value) || 0;

//     // Validar cédula (11 dígitos)
//     if (!/^\d{11}$/.test(cedula)) {
//         mostrarNotificacion('Cédula inválida. Debe tener 11 dígitos', 'error');
//         document.getElementById('cedula').focus();
//         return;
//     }

//     // Validaciones generales
//     if (!nombre || !tipoPrestamo) {
//         mostrarNotificacion('Complete todos los campos de información del cliente', 'error');
//         return;
//     }

//     if (!monto || monto <= 0 || !tasaMensual || tasaMensual <= 0 || !plazo || plazo < 1 || plazo > 12 || !frecuencia) {
//         mostrarNotificacion('Complete todos los campos correctamente (Plazo 1-12 meses)', 'error');
//         return;
//     }

//     // Cálculos con interés simple
//     const totalPagos = plazo * frecuencia;
//     const interesTotal = monto * tasaMensual * plazo;
//     const totalPagar = monto + interesTotal;
//     const pagoPorPeriodo = totalPagar / totalPagos;

//     // Mostrar resultados
//     document.getElementById('resultado').style.display = 'block';
//     document.getElementById('montoResumen').textContent = formatoRD(monto);
//     document.getElementById('total').textContent = formatoRD(totalPagar);
//     document.getElementById('intereses').textContent = formatoRD(interesTotal);
//     document.getElementById('pagoPeriodo').textContent = formatoRD(pagoPorPeriodo);

//     // Generar tabla de amortización
//     generarTablaAmortizacion(monto, tasaMensual, plazo, frecuencia);
// }

// // Función para generar la tabla de amortización
// function generarTablaAmortizacion(monto, tasaMensual, plazo, frecuencia) {
//     const cuerpoTabla = document.getElementById('cuerpoTabla');
//     const tablaContainer = document.getElementById('tablaContainer');
//     cuerpoTabla.innerHTML = '';
//     tablaContainer.style.display = 'block';

//     let saldo = monto;
//     const totalPagos = plazo * frecuencia;
//     const pagoCapital = monto / totalPagos;
//     const interesPorPeriodo = (monto * tasaMensual) / frecuencia;

//     for (let i = 1; i <= totalPagos; i++) {
//         const totalPago = pagoCapital + interesPorPeriodo;
//         saldo -= pagoCapital;

//         const fila = document.createElement('tr');
//         fila.innerHTML = `
//             <td>${i}</td>
//             <td>${formatoRDEnteros(pagoCapital)}</td>
//             <td>${formatoRDEnteros(interesPorPeriodo)}</td>
//             <td>${formatoRDEnteros(totalPago)}</td>
//             <td>${formatoRDEnteros(saldo > 0 ? saldo : 0)}</td>
//         `;

//         cuerpoTabla.appendChild(fila);
//     }
// }

// // Función para guardar la información del préstamo
// function guardarInformacion() {
//     // Validar que se haya calculado primero
//     if (!document.getElementById('resultado').style.display || document.getElementById('resultado').style.display === 'none') {
//         mostrarNotificacion('Debe calcular el préstamo antes de guardar', 'error');
//         return;
//     }
    
//     // Validar formulario completo
//     const form = document.getElementById('formularioPrestamo');
//     const requiredFields = form.querySelectorAll('[required]');
//     let isValid = true;
    
//     requiredFields.forEach(field => {
//         if (!field.value.trim()) {
//             field.style.borderColor = 'var(--danger)';
//             isValid = false;
//         } else {
//             field.style.borderColor = '';
//         }
//     });
    
//     // Validar cédula específicamente
//     const cedula = document.getElementById('cedula').value.trim();
//     if (!/^\d{11}$/.test(cedula)) {
//         mostrarNotificacion('Cédula inválida. Debe tener 11 dígitos', 'error');
//         document.getElementById('cedula').style.borderColor = 'var(--danger)';
//         isValid = false;
//     }
    
//     // Validar observación (opcional)
//     const observacion = document.getElementById('observacion').value.trim();
//     if (observacion.length > 500) {
//         mostrarNotificacion('La observación no puede exceder los 500 caracteres', 'error');
//         document.getElementById('observacion').style.borderColor = 'var(--danger)';
//         isValid = false;
//     }
    
//     if (!isValid) {
//         mostrarNotificacion('Complete todos los campos obligatorios correctamente', 'error');
//         return;
//     }
    
//     // Enviar el formulario
//     form.submit();
// }

// // Agregar CSS para notificaciones
// const notificationCSS = `
//     .notificacion {
//         position: fixed;
//         top: 20px;
//         right: 20px;
//         padding: 1rem 1.5rem;
//         border-radius: 8px;
//         box-shadow: var(--card-shadow);
//         z-index: 1000;
//         display: flex;
//         align-items: center;
//         gap: 0.75rem;
//         opacity: 0;
//         transform: translateY(-20px);
//         transition: all 0.3s ease;
//     }
    
//     .notificacion-success {
//         background-color: var(--accent);
//         color: white;
//     }
    
//     .notificacion-error {
//         background-color: var(--danger);
//         color: white;
//     }
    
//     .notificacion i {
//         font-size: 1.2rem;
//     }
// `;

// // Inyectar CSS al documento
// const style = document.createElement('style');
// style.textContent = notificationCSS;
// document.head.appendChild(style);

document.addEventListener('DOMContentLoaded', function() {
    // Control del menú móvil
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');

    function toggleMenu() {
        sidebar.classList.toggle('active');
        overlay.style.display = sidebar.classList.contains('active') ? 'block' : 'none';
        document.body.style.overflow = sidebar.classList.contains('active') ? 'hidden' : 'auto';
    }

    mobileMenuBtn.addEventListener('click', toggleMenu);
    overlay.addEventListener('click', toggleMenu);

    // Configurar eventos de búsqueda
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', debounce(buscador_cliente, 300));
    searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            buscador_cliente();
        }
    });

    // Configurar validación de cédula en tiempo real
    document.getElementById('cedula').addEventListener('input', function(e) {
        this.value = this.value.replace(/-/g, '');
        if (this.value.length !== 11 || !/^\d+$/.test(this.value)) {
            this.style.borderColor = 'var(--danger)';
        } else {
            this.style.borderColor = '';
        }
    });

    // Configurar formato de monto
    document.getElementById('monto').addEventListener('input', formatCurrencyInput);
    
    // Validar formulario antes de enviar
    document.getElementById('formularioPrestamo').addEventListener('submit', function(e) {
        // Limpiar formato de monto
        const montoInput = document.getElementById('monto');
        montoInput.value = montoInput.value.replace(/,/g, '');
        
        // Validar que todos los campos requeridos estén completos
        const requiredFields = this.querySelectorAll('[required]');
        let allValid = true;
        
        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                field.style.borderColor = 'var(--danger)';
                allValid = false;
            }
        });
        
        if (!allValid) {
            e.preventDefault();
            mostrarNotificacion('Complete todos los campos obligatorios', 'error');
        }
    });
});

// Función para formatear entrada de moneda
function formatCurrencyInput(e) {
    let value = e.target.value.replace(/,/g, '');
    if(!isNaN(value) && value !== '') {
        e.target.value = parseFloat(value).toLocaleString('es-DO');
    }
}

// Función de formato RD
function formatoRD(numero) {
    return new Intl.NumberFormat('es-DO', {
        style: 'currency',
        currency: 'DOP',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    }).format(numero);
}

// Función de formato RD para enteros
function formatoRDEnteros(numero) {
    return new Intl.NumberFormat('es-DO', {
        style: 'currency',
        currency: 'DOP',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
    }).format(Math.round(numero));
}

// Función para cerrar resultados de búsqueda
function cerrarResultados() {
    document.getElementById('searchResults').style.display = 'none';
}

// Función debounce para evitar múltiples llamadas
function debounce(func, wait) {
    let timeout;
    return function() {
        const context = this, args = arguments;
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(context, args), wait);
    };
}

// Función para buscar clientes en el servidor
async function buscador_cliente() {
    const searchTerm = document.getElementById('searchInput').value.trim();
    const searchResults = document.getElementById('searchResults');
    const resultsList = document.getElementById('resultsList');
    
    if (searchTerm.length < 2) {
        searchResults.style.display = 'none';
        return;
    }
    
    try {
        // Mostrar indicador de carga
        resultsList.innerHTML = '<div class="no-results"><i class="fas fa-spinner fa-spin"></i><p>Buscando clientes...</p></div>';
        searchResults.style.display = 'block';
        
        const response = await fetch(`/buscador-cliente/?q=${encodeURIComponent(searchTerm)}`);
        
        if (!response.ok) {
            throw new Error(`Error HTTP: ${response.status}`);
        }
        
        const clientes = await response.json();
        
        resultsList.innerHTML = '';
        
        if (clientes.length > 0) {
            clientes.forEach(cliente => {
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <div class="client-info">
                        <div class="client-name">${cliente.nombres}</div>
                        <div class="client-cedula">Cédula: ${cliente.numero_identificacion}</div>
                        ${cliente.telefono ? `<div class="client-phone">Tel: ${cliente.telefono}</div>` : ''}
                    </div>
                    <button class="select-btn" onclick="seleccionarCliente('${cliente.numero_identificacion}', '${cliente.nombres.replace(/'/g, "\\'")}')">
                        <i class="fas fa-check"></i> Seleccionar
                    </button>
                `;
                resultsList.appendChild(resultItem);
            });
        } else {
            resultsList.innerHTML = `
                <div class="no-results">
                    <i class="fas fa-user-slash"></i>
                    <p>No se encontraron clientes con ese criterio de búsqueda</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('Error al buscar clientes:', error);
        resultsList.innerHTML = `
            <div class="no-results">
                <i class="fas fa-exclamation-triangle"></i>
                <p>Error al buscar clientes. Intente nuevamente.</p>
            </div>
        `;
    }
}

// Función para seleccionar un cliente
function seleccionarCliente(cedula, nombre) {
    const cedulaLimpia = cedula.replace(/-/g, '');
    document.getElementById('cedula').value = cedulaLimpia;
    document.getElementById('nombre').value = nombre;
    cerrarResultados();
    mostrarNotificacion(`Cliente seleccionado: ${nombre}`);
    document.getElementById('tipoPrestamo').focus();
}

// Función para mostrar notificaciones
function mostrarNotificacion(mensaje, tipo = 'success') {
    const notificacion = document.createElement('div');
    notificacion.className = `notificacion notificacion-${tipo}`;
    notificacion.innerHTML = `
        <i class="fas ${tipo === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
        <span>${mensaje}</span>
    `;
    
    document.body.appendChild(notificacion);
    
    setTimeout(() => {
        notificacion.style.opacity = '1';
        notificacion.style.transform = 'translateY(0)';
    }, 10);
    
    setTimeout(() => {
        notificacion.style.opacity = '0';
        notificacion.style.transform = 'translateY(-20px)';
        setTimeout(() => notificacion.remove(), 300);
    }, 3000);
}

// Función para calcular el préstamo
function calcularPrestamo() {
    // Obtener y validar valores
    const cedula = document.getElementById('cedula').value.trim();
    const nombre = document.getElementById('nombre').value.trim();
    const tipoPrestamo = document.getElementById('tipoPrestamo').value;
    const monto = parseFloat(document.getElementById('monto').value.replace(/,/g, '')) || 0;
    const tasaMensual = parseFloat(document.getElementById('tasa').value) / 100 || 0;
    const plazo = parseInt(document.getElementById('plazo').value) || 0;
    const frecuencia = parseInt(document.getElementById('frecuencia').value) || 0;
    const tasaMora = parseFloat(document.getElementById('tasaMora').value) || 0;

    // Validar cédula (11 dígitos)
    if (!/^\d{11}$/.test(cedula)) {
        mostrarNotificacion('Cédula inválida. Debe tener 11 dígitos', 'error');
        document.getElementById('cedula').focus();
        return;
    }

    // Validaciones generales
    if (!nombre || !tipoPrestamo) {
        mostrarNotificacion('Complete todos los campos de información del cliente', 'error');
        return;
    }

    if (!monto || monto <= 0 || !tasaMensual || tasaMensual <= 0 || !plazo || plazo < 1 || plazo > 12 || !frecuencia) {
        mostrarNotificacion('Complete todos los campos correctamente (Plazo 1-12 meses)', 'error');
        return;
    }

    // Cálculos con interés simple
    const totalPagos = plazo * frecuencia;
    const interesTotal = monto * tasaMensual * plazo;
    const totalPagar = monto + interesTotal;
    const pagoPorPeriodo = totalPagar / totalPagos;

    // Mostrar resultados
    document.getElementById('resultado').style.display = 'block';
    document.getElementById('montoResumen').textContent = formatoRD(monto);
    document.getElementById('total').textContent = formatoRD(totalPagar);
    document.getElementById('intereses').textContent = formatoRD(interesTotal);
    document.getElementById('pagoPeriodo').textContent = formatoRD(pagoPorPeriodo);

    // Generar tabla de amortización
    generarTablaAmortizacion(monto, tasaMensual, plazo, frecuencia);
}

// Función para generar la tabla de amortización
function generarTablaAmortizacion(monto, tasaMensual, plazo, frecuencia) {
    const cuerpoTabla = document.getElementById('cuerpoTabla');
    const tablaContainer = document.getElementById('tablaContainer');
    cuerpoTabla.innerHTML = '';
    tablaContainer.style.display = 'block';

    let saldo = monto;
    const totalPagos = plazo * frecuencia;
    const pagoCapital = monto / totalPagos;
    const interesPorPeriodo = (monto * tasaMensual) / frecuencia;

    for (let i = 1; i <= totalPagos; i++) {
        const totalPago = pagoCapital + interesPorPeriodo;
        saldo -= pagoCapital;

        const fila = document.createElement('tr');
        fila.innerHTML = `
            <td>${i}</td>
            <td>${formatoRDEnteros(pagoCapital)}</td>
            <td>${formatoRDEnteros(interesPorPeriodo)}</td>
            <td>${formatoRDEnteros(totalPago)}</td>
            <td>${formatoRDEnteros(saldo > 0 ? saldo : 0)}</td>
        `;

        cuerpoTabla.appendChild(fila);
    }
}

// Función para guardar la información del préstamo
function guardarInformacion() {
    // Validar que se haya calculado primero
    if (!document.getElementById('resultado').style.display || 
        document.getElementById('resultado').style.display === 'none') {
        mostrarNotificacion('Debe calcular el préstamo antes de guardar', 'error');
        return;
    }
    
    // Validar formulario completo
    const form = document.getElementById('formularioPrestamo');
    const requiredFields = form.querySelectorAll('[required]');
    let isValid = true;
    
    requiredFields.forEach(field => {
        if (!field.value.trim()) {
            field.style.borderColor = 'var(--danger)';
            isValid = false;
        } else {
            field.style.borderColor = '';
        }
    });
    
    // Validar cédula específicamente
    const cedula = document.getElementById('cedula').value.trim();
    if (!/^\d{11}$/.test(cedula)) {
        mostrarNotificacion('Cédula inválida. Debe tener 11 dígitos', 'error');
        document.getElementById('cedula').style.borderColor = 'var(--danger)';
        isValid = false;
    }
    
    // Validar observación (opcional)
    const observacion = document.getElementById('observacion').value.trim();
    if (observacion.length > 500) {
        mostrarNotificacion('La observación no puede exceder los 500 caracteres', 'error');
        document.getElementById('observacion').style.borderColor = 'var(--danger)';
        isValid = false;
    }
    
    if (!isValid) {
        mostrarNotificacion('Complete todos los campos obligatorios correctamente', 'error');
        return;
    }
    
    // Asegurar formato correcto del monto antes de enviar
    const montoInput = document.getElementById('monto');
    montoInput.value = montoInput.value.replace(/,/g, '');
    
    // Enviar el formulario
    form.submit();
}

// Inyectar CSS para notificaciones
const notificationCSS = `
    .notificacion {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        box-shadow: var(--card-shadow);
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        opacity: 0;
        transform: translateY(-20px);
        transition: all 0.3s ease;
    }
    
    .notificacion-success {
        background-color: var(--accent);
        color: white;
    }
    
    .notificacion-error {
        background-color: var(--danger);
        color: white;
    }
    
    .notificacion i {
        font-size: 1.2rem;
    }
`;

// Crear e inyectar el estilo
const style = document.createElement('style');
style.textContent = notificationCSS;
document.head.appendChild(style);
</script>
</body>
</html>